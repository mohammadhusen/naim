<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Silver Business Tracker</title>
</head>
<body>
  <h2>Silver Business</h2>

  <button id="addCustomerBtn">➕ Add Customer</button>
  <button id="viewCustomersBtn">👥 View Customers</button>

  <p id="db-status">DB: connecting...</p>

  <ul id="customerList"></ul>

<script>
let db;
let dbReady = false;

function openDB() {
    const request = indexedDB.open("SilverBusinessDB", 1);

    request.onupgradeneeded = function (e) {
        db = e.target.result;
        if (!db.objectStoreNames.contains("customers")) {
            db.createObjectStore("customers", { keyPath: "id", autoIncrement: true });
        }
    };

    request.onsuccess = function (e) {
        db = e.target.result;
        dbReady = true;
        document.getElementById("db-status").innerText = "DB: connected ✅";
        document.getElementById("addCustomerBtn").disabled = false;
        document.getElementById("viewCustomersBtn").disabled = false;
    };

    request.onerror = function () {
        document.getElementById("db-status").innerText = "DB: error ❌";
    };
}

function addCustomer() {
    if (!dbReady) {
        alert("Database not ready yet!");
        return;
    }
    const name = prompt("Enter customer name:");
    if (!name) return;

    const tx = db.transaction("customers", "readwrite");
    const store = tx.objectStore("customers");
    store.add({ name });

    tx.oncomplete = () => {
        alert("Customer added!");
    };
}

function viewCustomers() {
    if (!dbReady) {
        alert("Database not ready yet!");
        return;
    }
    const tx = db.transaction("customers", "readonly");
    const store = tx.objectStore("customers");
    const request = store.getAll();

    request.onsuccess = () => {
        const customers = request.result;
        const list = document.getElementById("customerList");
        list.innerHTML = "";

        if (customers.length === 0) {
            list.innerHTML = `<p>No customers found.</p>`;
            return;
        }

        customers.forEach(c => {
            const li = document.createElement("li");
            li.textContent = c.name;
            list.appendChild(li);
        });
    };
}

document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("addCustomerBtn").addEventListener("click", addCustomer);
    document.getElementById("viewCustomersBtn").addEventListener("click", viewCustomers);

    document.getElementById("addCustomerBtn").disabled = true;
    document.getElementById("viewCustomersBtn").disabled = true;

    openDB();
});
</script>
</body>
</html>
  </main> 
          <script>
let db;
const statusEl = document.getElementById("dbStatus");

function openDB() {
  return new Promise((resolve, reject) => {
    if (!window.indexedDB) {
      statusEl.textContent = "DB: not supported ❌";
      reject("IndexedDB not supported");
      return;
    }
    const request = indexedDB.open("SilverBusinessDB", 1);

    request.onerror = (event) => {
      statusEl.textContent = "DB: error ❌";
      reject(event);
    };

    request.onsuccess = (event) => {
      db = event.target.result;
      statusEl.textContent = "DB: connected ✅";
      resolve(db);
    };

    request.onupgradeneeded = (event) => {
      db = event.target.result;
      if (!db.objectStoreNames.contains("customers")) {
        const store = db.createObjectStore("customers", { keyPath: "id", autoIncrement: true });
        store.createIndex("name", "name", { unique: false });
      }
      statusEl.textContent = "DB: upgraded ✅";
    };
  });
}

// Example add customer
function addCustomer(name) {
  const tx = db.transaction("customers", "readwrite");
  const store = tx.objectStore("customers");
  return store.add({ name, investments: [], profits: [] });
}

document.addEventListener("DOMContentLoaded", async () => {
  try {
    await openDB();
    document.getElementById("addCustomerBtn").onclick = () => {
      const name = prompt("Enter customer name:");
      if (name) {
        addCustomer(name).onsuccess = () => alert("Customer added!");
      }
    };

    document.getElementById("viewCustomersBtn").onclick = () => {
      const tx = db.transaction("customers", "readonly");
      const store = tx.objectStore("customers");
      const req = store.getAll();
      req.onsuccess = () => {
        alert("Customers: " + req.result.map(c => c.name).join(", "));
      };
    };
  } catch (e) {
    console.error("DB error:", e);
  }
});
          </script>

</body>
</html>
